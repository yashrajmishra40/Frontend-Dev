<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Q6 - User Registration With Duplicate Check</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
      body {
        font-family: Arial;
        margin: 20px;
      }
      .error {
        color: red;
      }
      .success {
        color: green;
      }
    </style>
  </head>
  <body>
    <h2>User Registration</h2>
    <div id="msg"></div>
    <form id="reg">
      <label>Name: <input name="name" required /></label><br /><br />
      <label>Email: <input name="email" type="email" required /></label
      ><br /><br />
      <button type="submit">Register</button>
    </form>

    <script>
      const API = "http://localhost:3006/users";
      const form = document.getElementById("reg");
      form.addEventListener("submit", function (e) {
        e.preventDefault();
        const fd = new FormData(form);
        const name = fd.get("name").trim();
        const email = fd.get("email").trim();
        document.getElementById("msg").textContent = "Checking...";
        axios
          .get(API + "?email=" + encodeURIComponent(email))
          .then(function (res) {
            if (res.data && res.data.length > 0) {
              document.getElementById("msg").innerHTML =
                '<span class="error">Email already registered.</span>';
            } else {
              axios
                .post(API, { name: name, email: email })
                .then(function (r) {
                  document.getElementById("msg").innerHTML =
                    '<span class="success">Registration successful.</span>';
                  form.reset();
                })
                .catch(function (err) {
                  document.getElementById("msg").innerHTML =
                    '<span class="error">Failed to register.</span>';
                });
            }
          })
          .catch(function (err) {
            document.getElementById("msg").innerHTML =
              '<span class="error">Error checking email.</span>';
          });
      });
    </script>
  </body>
</html>
